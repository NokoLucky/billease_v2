# ios/fastlane/Fastfile
default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight using API Key"
  lane :beta do
    # Build the app
    build_app(
      workspace: "App.xcworkspace",
      scheme: "App",
      clean: true,
      export_method: "app-store",
      output_directory: "./build",
      silent: true,
      suppress_xcode_output: false
    )
    
    # Upload to TestFlight using API key
    upload_to_testflight(
      skip_waiting_for_build_processing: true,
      api_key_path: "./fastlane/api_key.json"
    )
  end

  desc "Build only - for testing"
  lane :build do
    build_app(
      workspace: "App.xcworkspace",
      scheme: "App",
      clean: true,
      export_method: "app-store",
      output_directory: "./build",
      silent: true,
      suppress_xcode_output: false
    )
  end
end