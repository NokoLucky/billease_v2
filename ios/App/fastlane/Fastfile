# ios/fastlane/Fastfile
default_platform(:ios)

platform :ios do
  desc "Build and upload to TestFlight"
  lane :beta do
    # Update the bundle identifier (if needed)
    update_app_identifier(
      xcodeproj: "App.xcodeproj",
      plist_path: "App/Info.plist",
      app_identifier: "com.billease.app.UNC2YV5NU9"
    )
    
    # Update version/build number (optional)
    increment_build_number(
      build_number: Time.now.strftime("%Y%m%d%H%M")
    )
    
    # Build the app - Fastlane handles all signing automatically
    build_app(
      workspace: "App.xcworkspace",
      scheme: "App",
      clean: true,
      export_method: "app-store",
      export_options: {
        provisioningProfiles: {
          "com.billease.app.UNC2YV5NU9" => ENV["PROVISIONING_PROFILE_NAME"] || "match AppStore com.billease.app.UNC2YV5NU9"
        }
      },
      output_directory: "./build"
    )
    
    # Upload to TestFlight
    upload_to_testflight(
      skip_waiting_for_build_processing: true,
      groups: ["External Testers"]  # Optional: specify test groups
    )
  end

  desc "Build only (for testing)"
  lane :build do
    build_app(
      workspace: "App.xcworkspace",
      scheme: "App",
      clean: true,
      export_method: "app-store",
      output_directory: "./build"
    )
  end
end